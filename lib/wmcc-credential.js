module.exports=function(t){function e(n){if(o[n])return o[n].exports;var r=o[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=7)}([function(t,e){t.exports=require("assert")},function(t,e,o){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.alg=n.alg.PBKDF2,this.hash=n.hashByVal[1],this.iter=1e4,this.salt=Buffer.alloc(0),this.r=0,this.p=0,this.length=32,this.locker=new l,t&&this.fromOptions(t)}function r(t,e){return t.charCodeAt(Math.floor(e%t.length))}const s=o(0),i=o(2),{util:a,Lock:l}=i.utils,{cleanse:c,pbkdf2:u,scrypt:h,digest:f}=i.crypto;n.alg={PBKDF2:0,SCRYPT:1},n.algByVal={0:"PBKDF2",1:"SCRYPT"},n.hash={SHA256:0,SHA512:1},n.hashByVal={0:"SHA256",1:"SHA512"},n.prototype.fromOptions=function(t){return s(t),null!=t.alg&&("string"==typeof t.alg?(this.alg=n.alg[t.alg.toUpperCase()],s(null!=this.alg,"Unknown algorithm.")):(s("number"==typeof t.alg),s(n.algByVal[t.alg]),this.alg=t.alg)),null!=t.hash&&("string"==typeof t.hash?(s(null!=n.hash[t.hash.toUpperCase()],"Unknown hash."),this.hash=n.hashByVal[n.hash[t.hash.toUpperCase()]]):(s("number"==typeof t.hash),s(n.hashByVal[t.hash]),this.hash=n.hashByVal[t.hash])),null!=t.iter&&(s(a.isU32(t.iter)),this.iter=t.iter),null!=t.r&&(s(a.isU32(t.r)),this.r=t.r),null!=t.p&&(s(a.isU32(t.p)),this.p=t.p),null!=t.length&&(s(a.isU32(t.length)),this.length=t.length),this},n.prototype.encrypt=async function(t,e,o){const n=await this.locker.lock();try{return await this._encrypt(t,e,o)}finally{n()}},n.prototype._encrypt=async function(t,e,o){if(!t&&!e&&!o)throw new Error("WalletID, DOB and Secret are required.");s(o instanceof Array);for(let t=0;t<o.length;t++)s(o[t]instanceof Object);return this.hashlock=await this.derive(t,e),this.secret(o)},n.prototype.decrypt=async function(t,e,o){const n=await this.locker.lock();try{return await this._decrypt(t,e,o)}finally{n()}},n.prototype._decrypt=async function(t,e,o){if(!t&&!e&&!o)throw new Error("WalletID, DOB and Lock are required.");if(a.isHex(o)){const t=new RegExp(`.{1,${2*this.length+2}}`,"g"),e=o.match(t);o=[];for(let t=0;t<e.length;t++)o[t]=Buffer.from(e[t],"hex")}else if(Buffer.isBuffer(o)){const t=o,e=this.length+1;o=[];for(let n=0;n<t.length/e;n++)o[n]=t.slice(n*e,n*e+e)}for(let t=0;t<o.length;t++)s(o[t].length===this.length+1);return s(o instanceof Array),this.hashlock=await this.derive(t,e),this.answers=Buffer.alloc(0),this.locks=o.slice(0),this.salt=Buffer.from(e,"utf8"),await this.question()},n.prototype.destroy=async function(){const t=await this.locker.lock();try{return await this._destroy()}finally{t()}},n.prototype._destroy=function(){this.hashlock&&(c(this.hashlock),this.hashlock=null),this.answers&&(this.answers=null),this.locks&&(c(this.locks),this.locks=null)},n.prototype.secret=function(t){if(!this.hashlock)return null;let e={},o=Buffer.alloc(0),n=Buffer.alloc(0);e.locks=[];for(let r=0;r<t.length;r++)e.locks[r]=this.lock(Buffer.from(t[r].question)),n=f.sha256(Buffer.from(t[r].answer)),o=f.sha256(Buffer.concat([o,n]));return e.passphrase=this.passphrase(o),e},n.prototype.lock=function(t){if(!this.hashlock)return null;let e;(e=Buffer.alloc(function(t,e){return Math.floor(Math.random()*(e-t+1)+t)}(t.length,this.length),0)).write(t.toString().replace(/\0/g,""),0);const o=this.hashlock.toString("ascii"),n=Buffer.from(e).toString("ascii"),s=Buffer.from(Array.prototype.map.call(o,function(t,e){return t.charCodeAt(0)^r(n,e)}));return Buffer.concat([Buffer.from([e.length]),s])},n.prototype.passphrase=function(t){if(s(Buffer.isBuffer(t)),!this.hashlock)return null;const e=f.sha256(this.hashlock).toString("ascii"),o=f.sha256(t).toString("ascii");return Buffer.from(Array.prototype.map.call(e,function(t,e){return t.charCodeAt(0)^r(o,e)}))},n.prototype.question=async function(){if(!this.hashlock)return null;let t={};if(this.locks.length){const e=this.hashlock.toString("ascii"),o=this.locks[0].slice(1,this.locks[0][0]+1);this.locks.shift(),t.question=Buffer.from(Array.prototype.map.call(o,function(t,o){return String.fromCharCode(t^r(e,o))}).join("").replace(/\0/g,""))}else t.passphrase=this.passphrase(this.answers);return t},n.prototype.setAnswer=function(t){const e=f.sha256(Buffer.from(t)),o=this.answers?Buffer.concat([this.answers,e]):e;return this.answers=f.sha256(o),this.question()},n.prototype.derive=async function(t,e){const o=this.iter,r=this.hash,s=this.r,i=this.p;if("string"==typeof t){Buffer.alloc(this.length,0).write(t.replace(/\0/g,""),0)}switch(Buffer.isBuffer(e)||(e=Buffer.from(e,"utf8")),this.alg){case n.alg.PBKDF2:return await u.deriveAsync(t,e,o,this.length,r);case n.alg.SCRYPT:return await h.deriveAsync(t,e,o,s,i,this.length);default:throw new Error(`Unknown algorithm: ${this.alg}.`)}},n.toObject=function(t){let e;return Array.isArray(t.locks)?e=a.concatArrBuf(t.locks):"string"==typeof t.locks?(s(a.isHex(t.locks)),e=Buffer.from(t.locks,"hex")):e=t.locks,s(Buffer.isBuffer(e)),s(Buffer.isBuffer(t.passphrase)),{lock:e,chksum:t.passphrase.slice(0,4)}},t.exports=n},function(t,e){t.exports=require("wmcc-core")},function(t,e,o){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.enable=t,this.code=null,this.key=null,this.retry=0,this.maxtry=5}const r=o(0),s=o(6),i=o(4),a=o(2),{digest:l}=a.crypto;n.prototype.encode=function(t){r(t,"Passphrase required.");const e=function(t,e){return Math.floor(Math.random()*(e-t+1))+t}(1e3,9999);this.code=s.randomBytes(16).toString("hex");const o=this._generateCode(e);return this.key=i.encrypt(t,o),e},n.prototype.decode=function(t,e){r(this.code,"OTP must be instantiate first");let o;const n=this._generateCode(t);try{o=Buffer.from(i.decrypt(this.key,n),"ascii")}catch(t){return this.retry++,this.retry>this.maxtry-1&&setTimeout(()=>{location.reload()},2e3),!1}if(this.retry=0,e){return{passphrase:o,otp:this.encode(o)}}return o},n.prototype._generateCode=function(t){r(t,"OTP required.");let e;for(let o=0;o<t;o++)0===o&&(e=this.code),e=l.sha256(Buffer.from(e)).toString("ascii");return e},n.prototype.isEnabled=function(){return this.enable},t.exports=n},function(t,e,o){"use strict";const n=t.exports;let r,s=[],i=[];n.encrypt=function(t,e){const o=n._UTF8.stringToBytes(t),r=n._utils.randomBytes(8),s=e.constructor==String?n._PBKDF2(e,r,32,{asBytes:!0}):e;return n._internal(o,s,n._utils.bytesToWords(r)),n._utils.bytesToHex(r.concat(o))},n.decrypt=function(t,e){const o=n._utils.hexToBytes(t),r=o.splice(0,8),s=e.constructor==String?n._PBKDF2(e,r,32,{asBytes:!0}):e;return n._internal(o,s,n._utils.bytesToWords(r)),n._UTF8.bytesToString(o)},n._internal=function(t,e,o){n._keysetup(e),o&&n._ivsetup(o);let r=[];for(let e=0;e<t.length;e++){if(e%16==0){n._nextstate(),r[0]=s[0]^s[5]>>>16^s[3]<<16,r[1]=s[2]^s[7]>>>16^s[5]<<16,r[2]=s[4]^s[1]>>>16^s[7]<<16,r[3]=s[6]^s[3]>>>16^s[1]<<16;for(let t=0;t<4;t++)r[t]=16711935&(r[t]<<8|r[t]>>>24)|4278255360&(r[t]<<24|r[t]>>>8);for(let t=120;t>=0;t-=8)r[t/8]=r[t>>>5]>>>24-t%32&255}t[e]^=r[e%16]}},n._keysetup=function(t){s[0]=t[0],s[2]=t[1],s[4]=t[2],s[6]=t[3],s[1]=t[3]<<16|t[2]>>>16,s[3]=t[0]<<16|t[3]>>>16,s[5]=t[1]<<16|t[0]>>>16,s[7]=t[2]<<16|t[1]>>>16,i[0]=n._utils.rotl(t[2],16),i[2]=n._utils.rotl(t[3],16),i[4]=n._utils.rotl(t[0],16),i[6]=n._utils.rotl(t[1],16),i[1]=4294901760&t[0]|65535&t[1],i[3]=4294901760&t[1]|65535&t[2],i[5]=4294901760&t[2]|65535&t[3],i[7]=4294901760&t[3]|65535&t[0],r=0;for(let t=0;t<4;t++)n._nextstate();for(let t=0;t<8;t++)i[t]^=s[t+4&7]},n._ivsetup=function(t){const e=n._utils.endian(t[0]),o=n._utils.endian(t[1]),r=e>>>16|4294901760&o,s=o<<16|65535&e;i[0]^=e,i[1]^=r,i[2]^=o,i[3]^=s,i[4]^=e,i[5]^=r,i[6]^=o,i[7]^=s;for(let t=0;t<4;t++)n._nextstate()},n._nextstate=function(){let t=[];for(let e=0;e<8;e++)t[e]=i[e];i[0]=i[0]+1295307597+r>>>0,i[1]=i[1]+3545052371+(i[0]>>>0<t[0]>>>0?1:0)>>>0,i[2]=i[2]+886263092+(i[1]>>>0<t[1]>>>0?1:0)>>>0,i[3]=i[3]+1295307597+(i[2]>>>0<t[2]>>>0?1:0)>>>0,i[4]=i[4]+3545052371+(i[3]>>>0<t[3]>>>0?1:0)>>>0,i[5]=i[5]+886263092+(i[4]>>>0<t[4]>>>0?1:0)>>>0,i[6]=i[6]+1295307597+(i[5]>>>0<t[5]>>>0?1:0)>>>0,i[7]=i[7]+3545052371+(i[6]>>>0<t[6]>>>0?1:0)>>>0,r=i[7]>>>0<t[7]>>>0?1:0;let e=[];for(let t=0;t<8;t++){const o=s[t]+i[t]>>>0,n=65535&o,r=o>>>16,a=((n*n>>>17)+n*r>>>15)+r*r,l=((4294901760&o)*o>>>0)+((65535&o)*o>>>0)>>>0;e[t]=a^l}s[0]=e[0]+(e[7]<<16|e[7]>>>16)+(e[6]<<16|e[6]>>>16),s[1]=e[1]+(e[0]<<8|e[0]>>>24)+e[7],s[2]=e[2]+(e[1]<<16|e[1]>>>16)+(e[0]<<16|e[0]>>>16),s[3]=e[3]+(e[2]<<8|e[2]>>>24)+e[1],s[4]=e[4]+(e[3]<<16|e[3]>>>16)+(e[2]<<16|e[2]>>>16),s[5]=e[5]+(e[4]<<8|e[4]>>>24)+e[3],s[6]=e[6]+(e[5]<<16|e[5]>>>16)+(e[4]<<16|e[4]>>>16),s[7]=e[7]+(e[6]<<8|e[6]>>>24)+e[5]},n._utils={randomBytes:function(t){let e=[];for(;t>0;t--)e.push(Math.floor(256*Math.random()));return e},randomHex:function(t){return n._utils.bytesToHex(n._utils.randomBytes(t))},wordsToBytes:function(t){let e=[];for(let o=0;o<32*t.length;o+=8)e.push(t[o>>>5]>>>24-o%32&255);return e},bytesToWords:function(t){let e=[];for(let o=0,n=0;o<t.length;o++,n+=8)e[n>>>5]|=t[o]<<24-n%32;return e},bytesToHex:function(t){let e=[];for(let o=0;o<t.length;o++)e.push((t[o]>>>4).toString(16)),e.push((15&t[o]).toString(16));return e.join("")},hexToBytes:function(t){let e=[];for(let o=0;o<t.length;o+=2)e.push(parseInt(t.substr(o,2),16));return e},wordsToHex:function(t){return new Buffer(Buffer.from(t).toString("hex"))},rotl:function(t,e){return t<<e|t>>>32-e},endian:function(t){if(t.constructor==Number)return 16711935&n._utils.rotl(t,8)|4278255360&n._utils.rotl(t,24);for(let e=0;e<t.length;e++)t[e]=n._utils.endian(t[e]);return t}},n._UTF8={stringToBytes:function(t){return n._Binary.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){try{return decodeURIComponent(escape(n._Binary.bytesToString(t)))}catch(t){throw new Error("ERROR DECODING URI: "+t.message)}}},n._Binary={stringToBytes:function(t){let e=[];for(let o=0;o<t.length;o++)e.push(255&t.charCodeAt(o));return e},bytesToString:function(t){let e=[];for(let o=0;o<t.length;o++)e.push(String.fromCharCode(t[o]));return e.join("")}},n._PBKDF2=function(t,e,o,r){function s(t,e){return n._HMAC(i,e,t,{asBytes:!0})}t.constructor==String&&(t=n._UTF8.stringToBytes(t)),e.constructor==String&&(e=n._UTF8.stringToBytes(e));const i=r&&r.hasher||n._SHA1,a=r&&r.iterations||1;let l=[],c=1;for(;l.length<o;){let o=s(t,e.concat(n._utils.wordsToBytes([c]))),r=o;for(let e=1;e<a;e++){r=s(t,r);for(let t=0;t<o.length;t++)o[t]^=r[t]}l=l.concat(o),c++}return l.length=o,r&&r.asBytes?l:r&&r.asString?n._Binary.bytesToString(l):n._utils.bytesToHex(l)},n._SHA1=function(t,e){const o=n._utils.wordsToBytes(n._SHA1._internal(t));return e&&e.asBytes?o:e&&e.asString?n._Binary.bytesToString(o):n._utils.bytesToHex(o)},n._SHA1._internal=function(t){t.constructor==String&&(t=n._UTF8.stringToBytes(t));let e=n._utils.bytesToWords(t),o=8*t.length,r=[],s=1732584193,i=-271733879,a=-1732584194,l=271733878,c=-1009589776;e[o>>5]|=128<<24-o%32,e[15+(o+64>>>9<<4)]=o;for(let t=0;t<e.length;t+=16){let o=s,n=i,u=a,h=l,f=c;for(let o=0;o<80;o++){if(o<16)r[o]=e[t+o];else{let t=r[o-3]^r[o-8]^r[o-14]^r[o-16];r[o]=t<<1|t>>>31}const n=(s<<5|s>>>27)+c+(r[o]>>>0)+(o<20?1518500249+(i&a|~i&l):o<40?1859775393+(i^a^l):o<60?(i&a|i&l|a&l)-1894007588:(i^a^l)-899497514);c=l,l=a,a=i<<30|i>>>2,i=s,s=n}s+=o,i+=n,a+=u,l+=h,c+=f}return[s,i,a,l,c]},n._HMAC=function(t,e,o,r){e.constructor==String&&(e=n._UTF8.stringToBytes(e)),o.constructor==String&&(o=n._UTF8.stringToBytes(o)),o.length>4*t._blocksize&&(o=t(o,{asBytes:!0}));let s=o.slice(0),i=o.slice(0);for(let e=0;e<4*t._blocksize;e++)s[e]^=92,i[e]^=54;const a=t(s.concat(t(i.concat(e),{asBytes:!0})),{asBytes:!0});return r&&r.asBytes?a:r&&r.asString?n._Binary.bytesToString(a):n._utils.bytesToHex(a)},t.exports=n},function(t,e,o){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=new r(t),this.network=this.options.network,this.logger=this.options.logger.context("authentication"),this.locker=new f,this.templocker=new f,this.hsm=new a({alg:this.options.alg,hash:this.options.hash,iter:this.options.iter,r:this.options.r,p:this.options.p,length:this.options.length}),this.otp=new l(this.options.otp),this.opened=!1,this.logged=!1,this.maxLock=10,this.wallets=[],this.load()}function r(t){if(!(this instanceof r))return new r(t);this.network=p.primary,this.logger=c.global,this.otp=!0,t&&this.fromOptions(t)}const s=o(6),i=o(0),a=o(1),l=o(3),c=o(9),u=o(2),{fs:h,Lock:f}=u.utils,{Network:p}=u.protocol;n.prototype.load=function(){this.logged?$("body").html("<menu><topmenu category='menu' module='top' tag='topmenu' active='true'></topmenu></menu><content></content>\n      <preload category='preload' module='preload' tag='preload' active='true'></preload>\n      <updater category='update' module='update' tag='updater' active='true'></updater>\n      <notification category='notification' module='main' tag='notification' active='true'></notification>"):$("body").html("<logo><img src='../image/head_logo.png'></logo><menu><tabs category='menu' module='auth' tag='tabs' active='true'></tabs></menu>\n      <content></content><preload category='preload' module='preload' tag='preload' active='true'></preload>\n      <copyright>WMCC Application &copy; World Mobile Coin</copyright>\n      \x3c!--<updater category='update' module='update' tag='updater' active='true'></updater>--\x3e")},n.prototype.open=async function(t,e){const o=await this.locker.lock();try{return await this._open(t,e)}finally{o()}},n.prototype._open=async function(t,e){i("object"==typeof t),i("object"==typeof e),e.loaded||await e.open(),await t.open(),this.opened=!0},n.prototype.tempopen=async function(t,e){const o=await this.templocker.lock();try{return await this._tempopen(t,e)}finally{o()}},n.prototype._tempopen=async function(t,e){i("object"==typeof t),i("object"==typeof e),e.loaded||await e.open();const o=t.bound;this.opened&&(t.bound=!0),await t.db.open(),t.bound=o,this.opened=!0},n.prototype.tempclose=async function(t,e){const o=await this.templocker.lock();try{return await this._tempclose(t,e)}finally{o()}},n.prototype._tempclose=async function(t,e){i("object"==typeof t),await t.db.close(),e&&(i("object"==typeof e),await e.close()),this.opened=!1},n.prototype.close=async function(t,e){const o=await this.locker.lock();try{return await this._close(t,e)}finally{o()}},n.prototype._close=async function(t,e){i("object"==typeof t),await t.close(),e&&(i("object"==typeof e),await e.close()),this.opened=!1},n.prototype.render=async function(t,e){const o=e.info.wallet?e.info.wallet.account.id:null,n=t.list(),r=[];if(n.length>0){for(let t of n){const e=t.split(".").shift();try{const t=this.fromSuffix(e);if(t===o)continue;r.push(t)}catch(t){}}r.sort();for(let t of r)$('select[name="name"]').append(`<option value="${t}">${t}</option>`),this.wallets=this.wallets.filter(e=>e!==t).concat([t])}this.wallets.length>0||$('menubutton[category="auth"][module="create"]').trigger("click")},n.prototype.saveWallet=async function(t,e,o,n,r){let s=await this.hsm.encrypt(o,n,r);const i=this.toSuffix(o);t.suffix(i),await this.ensure(t.db.db.location),await this.open(t,e),await t.set({id:o,hsm:s}),await this.hsm.destroy(),await this.close(t),s={}},n.prototype.ensure=function(t){return h.unsupported?Promise.resolve():h.mkdirp(t)},n.prototype.getOTP=function(t){return this.otp.encode(t)},n.prototype.getPassphrase=function(t,e){return this.otp.decode(t,e)},n.prototype.isOtpEnabled=function(){return this.otp.isEnabled()},n.prototype.getMaxLock=function(){return this.maxLock},n.prototype.toSuffix=function(t){const e=s.createCipher("aes128","wmcc-wallet");return`${e.update(t,"utf8","hex")}${e.final("hex")}`},n.prototype.fromSuffix=function(t){const e=s.createDecipher("aes128","wmcc-wallet");return`${e.update(t,"hex","utf8")}${e.final("utf8")}`},n.prototype.destroy=function(){this.opened=!1,this.logged=!1},r.prototype.fromOptions=function(t){null!=t.network&&(this.network=p.get(t.network)),null!=t.logger&&(i("object"==typeof t.logger),this.logger=t.logger),null!=t.otp&&(i("boolean"==typeof t.otp),this.otp=t.otp),null!=t.alg&&(i("string"==typeof t.alg||"number"==typeof t.alg),this.alg=t.alg),null!=t.hash&&(i("string"==typeof t.hash||"number"==typeof t.hash),this.hash=t.hash),null!=t.iter&&(i("number"==typeof t.iter),this.iter=t.iter),null!=t.r&&(i("number"==typeof t.r),this.r=t.r),null!=t.p&&(i("number"==typeof t.p),this.p=t.p),null!=t.length&&(i("number"==typeof t.length),this.length=t.length)},r.fromOptions=function(t){return(new r).fromOptions(t)},t.exports=n},function(t,e){t.exports=require("crypto")},function(t,e,o){"use strict";const n=e;n.cache=function(){},n.Credential=o(8),n.auth=o(5),n.hsm=o(1),n.otp=o(3),n.rabbit=o(4),global.wmcc_credential=n},function(t,e,o){"use strict";e.Auth=o(5),e.HSM=o(1),e.OTP=o(3),e.Rabbit=o(4)},function(t,e){t.exports=require("wmcc-logger")}]);